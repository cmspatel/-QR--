# Сервис коротких ссылок с QR-кодами

Веб-приложение для создания коротких ссылок с автоматической генерацией QR-кодов, построенное на Yii2 Framework.

## Возможности

- ✅ Создание коротких ссылок из длинных URL
- ✅ Валидация и проверка доступности URL
- ✅ Автоматическая генерация QR-кодов
- ✅ Скачивание QR-кодов
- ✅ Подсчет переходов по ссылкам
- ✅ Логирование IP адресов и User Agent
- ✅ AJAX интерфейс без перезагрузки страницы
- ✅ Статистика и аналитика

## Технический стек

- **Backend**: Yii2 Framework (PHP 7.4+)
- **Database**: MySQL 5.7+ / MariaDB 10.2+
- **Frontend**: jQuery, Bootstrap 5
- **QR Codes**: Endroid QR Code Library
- **HTTP Client**: Guzzle HTTP Client

## Быстрая установка

### 1. Клонирование и установка зависимостей

```bash
git clone <repository-url>
cd yii_framework/basic
composer install
```

### 2. Настройка базы данных

#### Вариант A: Использование дампа (рекомендуется)
```bash
mysql -u root < database_dump.sql
```

#### Вариант B: Ручная настройка
1. Создайте базу данных `qr_database`
2. Настройте подключение в `config/db.php`
3. Выполните миграцию: `php yii migrate`

### 3. Настройка прав доступа

```bash
chmod 777 runtime/
chmod 777 web/assets/
mkdir web/qr-codes && chmod 777 web/qr-codes/
```

### 4. Запуск

Откройте браузер и перейдите по адресу: `http://192.168.1.7/yii_framework/basic/web/`

## Структура проекта

```
basic/
├── controllers/
│   ├── SiteController.php      # Главный контроллер
│   ├── SController.php         # Обработка коротких ссылок
│   └── StatsController.php     # Статистика
├── models/
│   ├── ShortLink.php          # Модель коротких ссылок
│   └── LinkClick.php          # Модель логов переходов
├── views/
│   ├── site/
│   │   └── index.php          # Главная страница
│   └── stats/
│       ├── index.php          # Общая статистика
│       └── view.php           # Детальная статистика
├── migrations/
│   └── m240101_000001_create_short_links_tables.php
├── web/
│   ├── qr-codes/              # Папка для QR кодов
│   └── .htaccess              # Конфигурация Apache
└── database_dump.sql          # Дамп базы данных
```

## Использование

### Создание короткой ссылки

1. Откройте главную страницу
2. Введите URL в поле ввода
3. Нажмите кнопку "ОК"
4. Получите короткую ссылку и QR код

### Переход по короткой ссылке

Короткие ссылки имеют формат: `http://192.168.1.7/s/XXXXXXX`

### Просмотр статистики

- Общая статистика: `/stats/index`
- Детальная статистика: `/stats/view?id=X`

## API Endpoints

### POST /site/create-short-link
Создание короткой ссылки

**Параметры:**
- `url` (string) - URL для сокращения

**Ответ:**
```json
{
    "success": true,
    "message": "Короткая ссылка создана успешно",
    "shortUrl": "http://192.168.1.7/s/AbC123Xy",
    "qrCode": "/qr-codes/AbC123Xy.svg",
    "clicksCount": 0
}
```

## База данных

### Таблица `short_links`
- `id` - первичный ключ
- `original_url` - оригинальная ссылка
- `short_code` - короткий код (8 символов)
- `qr_code_path` - путь к QR коду
- `clicks_count` - количество переходов
- `created_at` - дата создания
- `updated_at` - дата обновления

### Таблица `link_clicks`
- `id` - первичный ключ
- `short_link_id` - ID короткой ссылки
- `ip_address` - IP адрес пользователя
- `user_agent` - User Agent браузера
- `referer` - реферер
- `clicked_at` - время перехода

## Безопасность

- Валидация всех URL перед сохранением
- Проверка доступности ресурса
- CSRF защита для AJAX запросов
- Логирование для аналитики

## Устранение неполадок

### Ошибка "URL не доступен"
- Проверьте интернет-соединение
- Убедитесь, что URL корректный
- Некоторые сайты могут блокировать запросы

### Ошибка создания QR кода
- Проверьте права доступа к папке `web/qr-codes/`
- Убедитесь, что PHP имеет права на запись

### Ошибка миграции
- Проверьте настройки подключения к базе данных
- Убедитесь, что база данных существует

## Подробная инструкция

См. файл [README_DEPLOYMENT.md](README_DEPLOYMENT.md) для подробной инструкции по развертыванию.

## Лицензия

BSD-3-Clause
