# Тестовое задание: Сервис коротких ссылок с QR-кодами

## Описание проекта

Реализован полнофункциональный сервис коротких ссылок с автоматической генерацией QR-кодов на базе Yii2 Framework. Проект соответствует всем требованиям технического задания и включает дополнительные возможности для аналитики.

## Выполненные требования

### ✅ Основные требования

1. **Стек технологий**
   - Yii2 Framework (Basic)
   - MySQL/MariaDB
   - jQuery
   - Bootstrap 5

2. **Главная страница**
   - Форма с полем ввода для URL
   - Кнопка "ОК" для обработки
   - AJAX обработка без перезагрузки страницы

3. **Валидация URL**
   - Проверка корректности формата URL (http/https)
   - Проверка доступности ресурса
   - Вывод сообщения "Данный URL не доступен" при недоступности

4. **Создание коротких ссылок**
   - Генерация уникального 8-символьного кода
   - Сохранение в базе данных
   - Автоматическая генерация QR-кода

5. **QR-коды**
   - Автоматическая генерация при создании ссылки
   - Возможность сканирования камерой телефона
   - Скачивание QR-кода

6. **Переход по коротким ссылкам**
   - Отдельный контроллер для обработки переходов
   - Редирект на оригинальную ссылку
   - Логирование IP адресов
   - Подсчет количества переходов

### ✅ Дополнительные возможности

1. **Аналитика и статистика**
   - Страница общей статистики всех ссылок
   - Детальная статистика по каждой ссылке
   - История переходов с IP адресами
   - Отслеживание User Agent и рефереров

2. **Пользовательский интерфейс**
   - Современный дизайн с Bootstrap 5
   - Адаптивная верстка
   - Копирование ссылок в буфер обмена
   - Уведомления о результатах операций

3. **Безопасность**
   - CSRF защита для AJAX запросов
   - Валидация всех входных данных
   - Безопасная генерация коротких кодов

## Структура проекта

### Модели
- `ShortLink` - модель для работы с короткими ссылками
- `LinkClick` - модель для логирования переходов

### Контроллеры
- `SiteController` - главный контроллер с формой создания ссылок
- `SController` - обработка переходов по коротким ссылкам
- `StatsController` - просмотр статистики

### Представления
- `site/index.php` - главная страница с формой
- `stats/index.php` - общая статистика
- `stats/view.php` - детальная статистика

### База данных
- `short_links` - таблица коротких ссылок
- `link_clicks` - таблица логов переходов

## API Endpoints

### POST /site/create-short-link
Создание короткой ссылки с валидацией и генерацией QR-кода.

**Параметры:**
- `url` (string) - URL для сокращения

**Ответ:**
```json
{
    "success": true,
    "message": "Короткая ссылка создана успешно",
    "shortUrl": "http://domain.com/s/AbC123Xy",
    "qrCode": "/qr-codes/AbC123Xy.png",
    "clicksCount": 0
}
```

### GET /s/{code}
Переход по короткой ссылке с логированием и редиректом.

## Особенности реализации

### Валидация URL
- Использование `filter_var()` для проверки формата
- HTTP-запросы через Guzzle для проверки доступности
- Таймаут 10 секунд для избежания зависания

### Генерация QR-кодов
- Использование библиотеки Endroid QR Code
- Размер QR-кода: 300x300 пикселей
- Сохранение в формате PNG в папке `web/qr-codes/`

### Логирование переходов
- Запись IP адреса, User Agent, реферера
- Автоматическое увеличение счетчика переходов
- Внешний ключ для целостности данных

### Безопасность
- Уникальные короткие коды (проверка на дубликаты)
- Валидация всех URL перед сохранением
- CSRF токены для AJAX запросов

## Установка и развертывание

### Требования
- PHP 7.4+
- MySQL 5.7+ / MariaDB 10.2+
- Composer
- Веб-сервер (Apache/Nginx)

### Быстрая установка
1. `composer install`
2. `mysql -u root -p < database_dump.sql`
3. Настроить права доступа к папкам
4. Открыть в браузере

Подробная инструкция в файле `README_DEPLOYMENT.md`.

## Тестирование

Проект включает тестовые данные в дампе базы данных:
- Примеры коротких ссылок
- Логи переходов для демонстрации функциональности

## Дополнительные файлы

- `database_dump.sql` - дамп базы данных с тестовыми данными
- `README_DEPLOYMENT.md` - подробная инструкция по развертыванию
- `migrations/` - миграции для создания таблиц

## Заключение

Проект полностью соответствует техническому заданию и включает все требуемые функции:
- ✅ Создание коротких ссылок
- ✅ Валидация и проверка URL
- ✅ Генерация QR-кодов
- ✅ Логирование переходов
- ✅ AJAX интерфейс
- ✅ Статистика и аналитика

Проект готов к развертыванию и использованию в продакшене. 