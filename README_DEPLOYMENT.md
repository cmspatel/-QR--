# Инструкция по развертыванию сервиса коротких ссылок

## Требования

- PHP 7.4 или выше
- MySQL 5.7+ или MariaDB 10.2+
- Composer
- Веб-сервер (Apache/Nginx)

## Установка

### 1. Клонирование проекта

```bash
git clone <repository-url>
cd yii_framework/basic
```

### 2. Установка зависимостей

```bash
composer install
```

### 3. Настройка базы данных

#### 3.1 Создание базы данных
```sql
CREATE DATABASE qr_database CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

#### 3.2 Настройка подключения
Отредактируйте файл `config/db.php`:

```php
<?php

return [
    'class' => 'yii\db\Connection',
    'dsn' => 'mysql:host=localhost;dbname=qr_database',
    'username' => 'root',
    'password' => '',
    'charset' => 'utf8mb4',
];
```

#### 3.3 Выполнение миграций
```bash
php yii migrate
```

### 4. Настройка веб-сервера

#### Apache
Убедитесь, что модуль `mod_rewrite` включен и файл `.htaccess` находится в папке `web/`.

#### Nginx
Добавьте в конфигурацию сервера:

```nginx
server {
    listen 80;
    server_name your-domain.com;
    root /path/to/yii_framework/basic/web;
    index index.php;

    location / {
        try_files $uri $uri/ /index.php$is_args$args;
    }

    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
}
```

### 5. Настройка прав доступа

```bash
chmod 777 runtime/
chmod 777 web/assets/
chmod 777 web/qr-codes/
```

### 6. Проверка установки

Откройте браузер и перейдите по адресу: `http://192.168.1.7/yii_framework/basic/web/`

## Функциональность

### Основные возможности:

1. **Создание коротких ссылок**
   - Валидация URL
   - Проверка доступности ресурса
   - Генерация уникального короткого кода

2. **QR коды**
   - Автоматическая генерация QR кодов
   - Возможность скачивания QR кода
   - Сканирование камерой телефона

3. **Аналитика**
   - Подсчет переходов по ссылкам
   - Логирование IP адресов
   - Отслеживание User Agent и рефереров

### Структура базы данных:

#### Таблица `short_links`:
- `id` - первичный ключ
- `original_url` - оригинальная ссылка
- `short_code` - короткий код (8 символов)
- `qr_code_path` - путь к QR коду
- `clicks_count` - количество переходов
- `created_at` - дата создания
- `updated_at` - дата обновления

#### Таблица `link_clicks`:
- `id` - первичный ключ
- `short_link_id` - ID короткой ссылки
- `ip_address` - IP адрес пользователя
- `user_agent` - User Agent браузера
- `referer` - реферер
- `clicked_at` - время перехода

## Использование

### Создание короткой ссылки:

1. Откройте главную страницу
2. Введите URL в поле ввода
3. Нажмите кнопку "ОК"
4. Получите короткую ссылку и QR код

### Переход по короткой ссылке:

Короткие ссылки имеют формат: `http://192.168.1.7/s/XXXXXXX`

При переходе по такой ссылке происходит:
1. Поиск оригинальной ссылки в базе
2. Логирование перехода
3. Увеличение счетчика переходов
4. Редирект на оригинальную ссылку

## Безопасность

- Все URL валидируются перед сохранением
- Проверяется доступность ресурса
- Используется CSRF защита для AJAX запросов
- IP адреса логируются для аналитики

## Устранение неполадок

### Ошибка "URL не доступен":
- Проверьте интернет-соединение
- Убедитесь, что URL корректный
- Некоторые сайты могут блокировать запросы

### Ошибка создания QR кода:
- Проверьте права доступа к папке `web/qr-codes/`
- Убедитесь, что PHP имеет права на запись

### Ошибка миграции:
- Проверьте настройки подключения к базе данных
- Убедитесь, что база данных существует

## Техническая поддержка

При возникновении проблем:
1. Проверьте логи в папке `runtime/logs/`
2. Убедитесь, что все зависимости установлены
3. Проверьте настройки веб-сервера 